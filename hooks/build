#!/bin/bash

if [ "$SOURCE_BRANCH" == "stable" ]; then
      TAG1="${DOCKER_REPO}:latest"
      STABLEVERSION=$(curl https://gunthy.trade/tag)
      TAGNAME="${STABLEVERSION}"
      TAG2="${DOCKER_REPO}:${TAGNAME}"
      GBVERSION="latest"
      GBOWNER="GuntharDeNiro"
      GBREPO="BTCT"
else
      TAG1="${DOCKER_REPO}:${SOURCE_BRANCH}"
      BETAVERSION=$(curl https://gunthy.trade/tagbeta)
      TAGNAME="${BETAVERSION}"
      TAG2="${DOCKER_REPO}:${TAGNAME}"
      GBVERSION="latest"
      GBOWNER="computeronix"
      GBREPO="BTCT-Beta"
fi

PLATFORM="linux/amd64,linux/arm64"

docker buildx create --name builder --driver docker-container --bootstrap --use
docker buildx build --push \
    --platform=${PLATFORM} \
    -f "${DOCKERFILE_PATH}" \
    -t ${TAG1} \
    -t ${TAG2} \
    --build-arg GUNBOTVERSION=${GBVERSION} \
    --build-arg GITHUBOWNER=${GBOWNER} \
    --build-arg GITHUBREPO=${GBREPO} \
    .
